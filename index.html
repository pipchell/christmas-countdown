<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Christmas Countdown</title>
  <style>
    @font-face {
      font-family: 'League Spartan';
      src: url('assets/LeagueSpartan-Bold.woff2') format('woff2');
      font-weight: bold;
      font-style: normal;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      font-family: 'League Spartan', sans-serif;
      font-weight: bold;
      background-color: #000;
      color: #1ED760;
      overflow: hidden;
      touch-action: manipulation;
    }

    .container {
      position: relative;
      z-index: 1;
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 0 15px;
    }

    h1 {
      font-size: min(8vw, 3.5rem);
      margin-bottom: min(4vw, 1.5rem);
      letter-spacing: 0.02em;
      white-space: nowrap;
    }

    .countdown {
      display: flex;
      justify-content: center;
      margin-bottom: min(4vw, 2rem);
      gap: 0.5rem;
      max-width: 90%;
      transform: scale(var(--zoom-level, 1));
      transform-origin: center;
    }

    .countdown-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 0;
      position: relative;
    }

    .countdown-colon {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: min(10vw, 4rem);
      opacity: 0.7;
      height: min(14vw, 5.5rem);
      padding: 0 0.2rem;
    }

    .countdown .value {
      font-size: min(14vw, 5.5rem);
      line-height: 1;
      text-align: center;
      min-width: 2ch;
    }

    .countdown .label {
      font-size: min(3.5vw, 1rem);
      opacity: 0.8;
      color: inherit;
      text-transform: capitalize;
      margin-top: 0.1rem;
    }

    canvas.snow {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 0;
    }

    /* Settings Button - Improved */
    #settings-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: rgba(0,0,0,0.7);
      color: #1ED760;
      border: 2px solid #1ED760;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      z-index: 100;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.3s ease;
      user-select: none;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      opacity: 1 !important;
    }

    #settings-toggle svg {
      width: 24px;
      height: 24px;
      fill: currentColor;
    }

    #settings-toggle:hover {
      transform: scale(1.1);
      background-color: rgba(30, 215, 96, 0.2);
    }

    /* Settings Menu */
    #settings-menu {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background-color: rgba(0,0,0,0.9);
      border: 2px solid #1ED760;
      border-radius: 12px;
      padding: 15px;
      display: none;
      flex-direction: column;
      gap: 12px;
      z-index: 100;
      max-width: 90vw;
      box-shadow: 0 4px 20px rgba(0,0,0,0.7);
    }

    .button {
      font-family: 'League Spartan', sans-serif;
      font-weight: bold;
      padding: 12px 15px;
      font-size: 1rem;
      color: #1ED760;
      background-color: rgba(0,0,0,0.6);
      border: 2px solid #1ED760;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      user-select: none;
      transition: all 0.2s ease;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 40px;
    }

    .button:hover {
      background-color: rgba(30, 215, 96, 0.3);
    }

    .button.active {
      background-color: rgba(30, 215, 96, 0.4);
    }

    /* Weather Widget */
    #weather-widget {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.7);
      border: 2px solid #1ED760;
      border-radius: 12px;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 50;
      font-size: 0.85rem;
      color: #1ED760;
      max-width: 95vw;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      flex-wrap: nowrap;
      white-space: nowrap;
    }

    /* Zoom Controls */
    .zoom-control {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
    }

    .zoom-control label {
      flex: 1;
      font-size: 0.9rem;
      text-align: left;
    }

    .zoom-control input[type="range"] {
      flex: 2;
      -webkit-appearance: none;
      height: 8px;
      background: rgba(30, 215, 96, 0.3);
      border-radius: 4px;
      outline: none;
    }

    .zoom-control input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #1ED760;
      cursor: pointer;
    }

    .zoom-value {
      width: 30px;
      text-align: center;
      font-size: 0.9rem;
    }

    /* Rest of your existing styles... */
  </style>
</head>
<body>

<!-- Your existing HTML content... -->

<!-- Settings Button - Updated with SVG -->
<button id="settings-toggle" aria-label="Settings" aria-expanded="false">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" />
  </svg>
</button>

<div id="settings-menu" role="region" aria-label="Settings Menu">
  <!-- Your existing settings buttons... -->
  
  <!-- Add this zoom control section -->
  <div class="zoom-control">
    <label for="zoom-slider">Zoom:</label>
    <input type="range" id="zoom-slider" min="0.5" max="1.5" step="0.1" value="1">
    <span class="zoom-value" id="zoom-value">100%</span>
  </div>
  
  <!-- Rest of your settings menu... -->
</div>

<script>
  // Updated initialization function
  function init() {
    loadPreferences();
    setupEventListeners();
    initSnow();
    animateSnow();
    updateCountdown();
    setInterval(updateCountdown, 1000);
    checkConnection();
    setInterval(checkConnection, 5000);
    
    // Initialize zoom control
    setupZoomControl();
  }

  // Add this new function for zoom control
  function setupZoomControl() {
    const zoomSlider = document.getElementById('zoom-slider');
    const zoomValue = document.getElementById('zoom-value');
    
    // Load saved zoom level
    const savedZoom = localStorage.getItem('countdownZoom');
    if (savedZoom) {
      document.documentElement.style.setProperty('--zoom-level', savedZoom);
      zoomSlider.value = savedZoom;
      zoomValue.textContent = `${Math.round(savedZoom * 100)}%`;
    }
    
    zoomSlider.addEventListener('input', (e) => {
      const zoomLevel = e.target.value;
      document.documentElement.style.setProperty('--zoom-level', zoomLevel);
      zoomValue.textContent = `${Math.round(zoomLevel * 100)}%`;
      localStorage.setItem('countdownZoom', zoomLevel);
    });
  }

  // Updated toggleSettingsMenu function
  function toggleSettingsMenu() {
    const isExpanded = settingsToggle.getAttribute('aria-expanded') === 'true';
    settingsToggle.setAttribute('aria-expanded', !isExpanded);
    settingsMenu.style.display = settingsMenu.style.display === 'flex' ? 'none' : 'flex';
  }

  // Updated toggleFullscreen function with better compatibility
  function toggleFullscreen(btn) {
    if (!document.fullscreenElement && 
        !document.webkitFullscreenElement && 
        !document.mozFullScreenElement &&
        !document.msFullscreenElement) {
      // Enter fullscreen
      if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen();
      } else if (document.documentElement.webkitRequestFullscreen) {
        document.documentElement.webkitRequestFullscreen();
      } else if (document.documentElement.mozRequestFullScreen) {
        document.documentElement.mozRequestFullScreen();
      } else if (document.documentElement.msRequestFullscreen) {
        document.documentElement.msRequestFullscreen();
      }
      btn.textContent = 'Exit Fullscreen';
    } else {
      // Exit fullscreen
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      }
      btn.textContent = 'Fullscreen';
    }
  }

  // Rest of your existing JavaScript...
</script>
</body>
</html>
